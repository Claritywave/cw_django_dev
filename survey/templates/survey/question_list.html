{% extends 'base.html' %}
{% block content %}
<h1>Preguntas</h1>
<div class="d-flex flex-column">
   {% for question in object_list %}
   <div class="card w-100 my-2 p-3">
      <div class="d-flex flex-row">
         <div class="col-10">
            <h3 class="fw-bold">{{ question.title }}</h3>
         </div>
         <div class="col-2">
            <span class="fw-lighter">Autor:</span> {{ question.author }}
         </div>
      </div>
      <div class="d-flex flex-row">
         <div class="col-10">
            <p class="fw-bold">{{ question.description }}</p>
         </div>
         <div class="col-2">
            <u class="fw-lighter mb-1">Eval√∫a la pregunta</u>
            <div>
               <a class="mx-1 like {% if question.user_likes is True  %}fas{% else %}fal{% endif %} fa-thumbs-up text-decoration-none"
                  href="#" data-question="{{ question.pk }}" data-value="like" ></a>
               <a class="mx-1 like {% if question.user_likes is False %}fas{% else %}fal{% endif %} fa-thumbs-up fa-flip-both text-decoration-none"
                  href="#" data-question="{{ question.pk }}" data-value="dislike"></a>
            </div>
         </div>
      </div>
      <div class="d-flex flex-row">
      </div>
      <br>
      <div class="d-flex justify-content-between">
         <div class="d-flex flex-column col-4">
         </div>
         <div class="col-4 d-flex flex-column ">
         </div>
         <div class="col-2">
            <u class="fw-lighter mb-1">Ranking:</u>
            <div>
               {{ question.ranking }} pts.
            </div>
         </div>
      </div>
      </br>
      {% for answer in question.question_answers.all %}
      <div class="card col12" style="padding: 10px;">
         <div class="d-flex flex-column col-4">
            <u class="fw-lighter mb-1">Respuesta de <b>{{ answer.author.username }}</b>.</u>
            <div>
               {% for val in '12345' %}
               <a class="mx-1 answer {% if answer.value|slugify >= val %}fas{% else %}fal{% endif %} fa-star text-decoration-none"
                  data-answer="{{ answer.pk }}"
                  data-value="{{ val }}" href="#"></a>
               {% endfor %}
            </div>
         </div>
         <div class="col-12 d-flex flex-column ">
            <p>{{ answer.comment}}</p>
         </div>
         <div class="col-2">
         </div>
      </div>
      {% endfor %}
      </br>
         <div class="d-grid gap-2">
         <button class="btn btn-primary" type="button">Agregar Respuesta</button>
         </div>
   </div>
   {% empty %}
   <div>No hay preguntas.</div>
   {% endfor %}
</div>
{% endblock %}
{% block js %}
<script>
   $.ajaxSetup({
       data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
   });
   
   $('a.answer').click(function (event) {
       event.preventDefault()
       let value =$(this).data('value')
       let answer =$(this).data('answer')
   
       $.post(
           '{% url "survey:question-answer" %}',
           {"answer_pk": answer, "value": value},
           function (data) {
               location.reload();
           }
       );
   });
   
   $('a.like').click(function (event) {
       event.preventDefault()
       let value = $(this).data('value')
       let question = $(this).data('question')
   
       $.post(
           '{% url "survey:question-like" %}',
           {"question_pk": question, "value": value},
           function (data) {
               location.reload();
           }
       );
   });
   
   
</script>
{% endblock %}